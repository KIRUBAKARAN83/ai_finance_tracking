{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>{% block title %}AI Finance Tracker{% endblock %}</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

<!-- PWA -->
<link rel="manifest" href="{% static 'manifest.json' %}">
<meta name="theme-color" content="#0d6efd">

<style>
/* (your styles unchanged) */
</style>
</head>

<body>

<!-- ================= NAVBAR ================= -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
<div class="container">
<a class="navbar-brand fw-bold" href="{% url 'transactions:dashboard' %}">AI Finance Tracker</a>

<button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#mainNav">
<span class="navbar-toggler-icon"></span>
</button>

<div class="collapse navbar-collapse" id="mainNav">
<ul class="navbar-nav ms-auto align-items-center">

{% if user.is_authenticated %}
<li class="nav-item">
<a class="nav-link {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}" href="{% url 'transactions:dashboard' %}">
<i class="bi bi-speedometer2"></i> Dashboard
</a>
</li>

<li class="nav-item">
<a class="nav-link {% if request.resolver_match.url_name == 'all_transactions' %}active{% endif %}" href="{% url 'transactions:all_transactions' %}">
<i class="bi bi-receipt"></i> Transactions
</a>
</li>

<li class="nav-item">
<a class="nav-link {% if request.resolver_match.url_name == 'budgets_list' %}active{% endif %}" href="{% url 'transactions:budgets_list' %}">
<i class="bi bi-pie-chart"></i> Budgets
</a>
</li>

{% if user.is_staff %}
<li class="nav-item">
<a class="nav-link {% if request.resolver_match.url_name == 'admin_dashboard' %}active{% endif %}" href="{% url 'transactions:admin_dashboard' %}">
<i class="bi bi-shield-lock"></i> Admin
</a>
</li>
{% endif %}

<li class="nav-item ms-2">
<button id="installBtn" class="btn btn-outline-primary btn-sm d-none">
<i class="bi bi-download"></i> Install
</button>
</li>

<li class="nav-item">
<form method="post" action="{% url 'logout' %}">
{% csrf_token %}
<button class="btn btn-link nav-link">Logout</button>
</form>
</li>
{% endif %}

<li class="nav-item ms-2">
<button id="themeToggle" class="btn btn-outline-light btn-sm">ðŸŒ™</button>
</li>
</ul>
</div>
</div>
</nav>

<!-- ================= CONTENT ================= -->
<div class="container my-5">
{% block content %}{% endblock %}
</div>

<!-- ================= MOBILE NAV ================= -->
<nav class="mobile-nav d-lg-none">
<a href="{% url 'transactions:dashboard' %}" class="{% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
<i class="bi bi-speedometer2"></i>Home</a>
<a href="{% url 'transactions:all_transactions' %}" class="{% if request.resolver_match.url_name == 'all_transactions' %}active{% endif %}">
<i class="bi bi-receipt"></i>Txns</a>
<a href="{% url 'transactions:budgets_list' %}" class="{% if request.resolver_match.url_name == 'budgets_list' %}active{% endif %}">
<i class="bi bi-pie-chart"></i>Budget</a>
<a href="#" id="installBtnMobile"><i class="bi bi-download"></i>Install</a>
</nav>

<!-- ================= CHATBOT ================= -->
<div id="chatbotBtn">ðŸ’¬</div>

<div id="chatbotBox">
<div class="chat-header">
ðŸ¤– Finance Assistant
<span id="chatClose">âœ–</span>
</div>

<div id="chatMessages"></div>

<form id="chatForm">
<input id="chatInput" placeholder="Ask about budgets, expensesâ€¦" autocomplete="off">
<button>âž¤</button>
</form>
</div>

<!-- ================= JS ================= -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* (your JS unchanged) */
</script>

<script>
const cb=document.getElementById("chatbotBtn"),
bx=document.getElementById("chatbotBox"),
cl=document.getElementById("chatClose"),
fm=document.getElementById("chatForm"),
ip=document.getElementById("chatInput"),
ms=document.getElementById("chatMessages");

cb.onclick=()=>bx.style.display="flex";
cl.onclick=()=>bx.style.display="none";

fm.onsubmit=e=>{
e.preventDefault();
const m=ip.value.trim(); if(!m)return;
ms.innerHTML+=`<div class="chat-user">ðŸ§‘ ${m}</div>`;
ip.value="";
fetch("{% url 'transactions:chat_api' %}",{
method:"POST",
headers:{
"Content-Type":"application/json",
"X-CSRFToken":"{{ csrf_token }}"
},
body:JSON.stringify({message:m})
})
.then(r=>r.json())
.then(d=>{
ms.innerHTML+=`<div class="chat-bot">ðŸ¤– ${d.reply}</div>`;
ms.scrollTop=ms.scrollHeight;
});
};
</script>

<script>
if("serviceWorker"in navigator){
navigator.serviceWorker.register("{% static 'service-worker.js' %}");
}
</script>

</body>
</html>
